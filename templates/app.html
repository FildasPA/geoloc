<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Geolocalisation BS</title>
		<style>
			.contenu {
				position: relative;
			}
			.dot {
				position: absolute;
				height: 25px;
				width: 25px;
				background-color: red;
				display: inline-block;
			}
			.balise {
				position: absolute;
				height: 25px;
				width: 25px;
				background-color: blue;
				border-radius: 50%;
				display: inline-block;
			}
		</style>
		<script>
			// Send a request to the server asking for the position
			function sendRequest() {
				var xmlhttp = new XMLHttpRequest();

				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState == XMLHttpRequest.DONE) {
						if (xmlhttp.status == 200) {
							var coor = JSON.parse(xmlhttp.responseText);
							updatePosition(coor['x'], coor['y'], 'dot');
						}	else {
							console.log('A problem occured during AJAX requesting');
						}
					}
				};

				xmlhttp.open("GET", "/getPosition", true);
				xmlhttp.send();
			}

			// Refresh position every 2 seconds
			var intervalID = window.setInterval(refreshPosition, 2000);
			function refreshPosition() {
				sendRequest();
			}

			// Update XBee icon position on the map
			function updatePosition(x, y,id) {
				console.log('x: '+x+', y: '+y);
				x = String(126 + x * 122)+'px';
				y = String(133 + y * 122)+'px';
				document.getElementById(id).style.left = x;
				document.getElementById(id).style.bottom = y;
			}

			window.onload = function() {
				updatePosition({{x}}, {{y}},'dot');
				updatePosition(0.9, 0.1,'BALISE_1');
				updatePosition(4.9, 0.1,'BALISE_2');
				updatePosition(1.2, 6.7,'BALISE_3');
				updatePosition(6.2, 6.7,'BALISE_4');
				updatePosition(-0.2, 3.4,'BALISE_5');
			}
		</script>
	</head>

	<body>
		<div class="contenu">
			<img src="static/plan-cropped.png">
			<span class="dot" id="dot"></span>
			<span class="balise" id="BALISE_1"></span>
			<span class="balise" id="BALISE_2"></span>
			<span class="balise" id="BALISE_3"></span>
			<span class="balise" id="BALISE_4"></span>
			<span class="balise" id="BALISE_5"></span>
		</div>
	</body>
</html>
